<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <parameter key="fivelab.resource.serializer.class">FiveLab\Component\Resource\Serializer\Serializer</parameter>
        <parameter key="fivelab.resource.serializer.normalizer.error_collection.class">FiveLab\Component\Resource\Serializer\Normalizer\ErrorCollectionObjectNormalizer</parameter>
        <parameter key="fivelab.resource.serializer.normalizer.paginated_collection.class">FiveLab\Component\Resource\Serializer\Normalizer\PaginatedCollectionNormalizer</parameter>
        <parameter key="fivelab.resource.serializer.normalizer.object.class">FiveLab\Component\Resource\Serializer\Normalizer\ObjectNormalizer</parameter>
        <parameter key="fivelab.resource.serializer.normalizer.datetime.class">Symfony\Component\Serializer\Normalizer\DateTimeNormalizer</parameter>
        <parameter key="fivelab.resource.serializer.encoder.json.class">Symfony\Component\Serializer\Encoder\JsonEncoder</parameter>
        <parameter key="fivelab.resource.serializer.encoder.xml.class">Symfony\Component\Serializer\Encoder\XmlEncoder</parameter>

        <parameter key="fivelab.resource.serializer.event_listener.generate_symfony_routes.class">FiveLab\Bundle\ResourceBundle\Resource\EventListener\GenerateSymfonyRouteHrefListener</parameter>
        <parameter key="fivelab.resource.serializer.event_listener.symfony_granted_relation.class">FiveLab\Bundle\ResourceBundle\Resource\EventListener\SymfonyGrantedRelationListener</parameter>
        <parameter key="fivelab.resource.serializer.event_listener.symfony_granted_action.class">FiveLab\Bundle\ResourceBundle\Resource\EventListener\SymfonyGrantedActionListener</parameter>
    </parameters>

    <services>
        <service id="fivelab.resource.serializer.normalizer.error_collection" class="%fivelab.resource.serializer.normalizer.error_collection.class%" public="false">
            <tag name="resource.serializer.normalizer"/>
        </service>

        <service id="fivelab.resource.serializer.normalizer.paginated_collection" class="%fivelab.resource.serializer.normalizer.paginated_collection.class%" public="false">
            <tag name="resource.serializer.normalizer"/>
        </service>

        <service id="fivelab.resource.serializer.normalizer.object" class="%fivelab.resource.serializer.normalizer.object.class%" public="false">
            <argument type="service" id="fivelab.resource.serializer.metadata_factory" on-invalid="null"/>
            <argument type="service" id="fivelab.resource.serializer.name_converter" on-invalid="null"/>
            <argument type="service" id="fivelab.resource.serializer.property_accessor" on-invalid="null"/>
            <argument type="service" id="fivelab.resource.serializer.property_info" on-invalid="null"/>
            <argument>%fivelab.resource.serializer.serialize_null%</argument>
            <tag name="resource.serializer.normalizer"/>
        </service>

        <service id="fivelab.resource.serializer.normalizer.datetime" class="%fivelab.resource.serializer.normalizer.datetime.class%" public="false">
            <tag name="resource.serializer.normalizer"/>
        </service>

        <service id="fivelab.resource.serializer.encoder.json" class="%fivelab.resource.serializer.encoder.json.class%" public="false">
            <tag name="resource.serializer.encoder"/>
        </service>

        <service id="fivelab.resource.serializer.encoder.xml" class="%fivelab.resource.serializer.encoder.xml.class%" public="false">
            <tag name="resource.serializer.encoder"/>
        </service>

        <service id="fivelab.resource.serializer" class="%fivelab.resource.serializer.class%">
            <argument type="collection"/>
            <argument type="collection"/>
            <argument type="service" id="fivelab.resource.serializer.event_dispatcher"/>
        </service>

        <!-- Event listeners -->
        <service id="fivelab.resource.serializer.event_listener.generate_symfony_routes" class="%fivelab.resource.serializer.event_listener.generate_symfony_routes.class%">
            <argument type="service" id="router"/>
            <tag name="kernel.event_listener" event="fivelab.serializer.normalization.before" method="onBeforeNormalization" priority="-128"/>
        </service>

        <service id="fivelab.resource.serializer.event_listener.symfony_granted_relation" class="%fivelab.resource.serializer.event_listener.symfony_granted_relation.class%" abstract="true">
            <argument type="service" id="security.authorization_checker"/>
            <tag name="kernel.event_listener" event="fivelab.serializer.normalization.before" method="onBeforeNormalization" priority="128"/>
        </service>

        <service id="fivelab.resource.serializer.event_listener.symfony_granted_action" class="%fivelab.resource.serializer.event_listener.symfony_granted_action.class%">
            <argument type="service" id="security.authorization_checker"/>
            <tag name="kernel.event_listener" event="fivelab.serializer.normalization.before" method="onBeforeNormalization" priority="128"/>
        </service>
    </services>
</container>
